<!DOCTYPE html>
<html>
<head>
<title>Books Data</title>

<style>
body { font-family: Arial; }

.top-bar {
  margin-bottom: 10px;
}

.spinner {
  display: inline-flex;
  align-items: center;
  border: 1px solid #ccc;
}

.spinner input {
  width: 40px;
  text-align: center;
  border: none;
}

.spinner button {
  border: none;
  background: #eee;
  cursor: pointer;
  padding: 2px 6px;
}

table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  font-size: 14px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

th {
  background: #f2f2f2;
  cursor: pointer;
}

.truncate {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.desc { width: 180px; }
.url { width: 160px; }
.small { width: 80px; }
</style>
</head>

<body>

<h3>Books Data</h3>

<div class="top-bar">
  Page
  <span class="spinner">
    <button onclick="changePage(-1)">▲</button>
    <input id="pageInput" value="1" readonly>
    <button onclick="changePage(1)">▼</button>
  </span>
  (10 books per page)

  <input type="text" placeholder="Search..." onkeyup="search(this.value)">
</div>

<table>
<thead>
<tr>
  <th onclick="sort('title')">Title <span id="title"></span></th>
  <th onclick="sort('isbn')">ISBN <span id="isbn"></span></th>
  <th onclick="sort('pageCount')">Pages <span id="pageCount"></span></th>
  <th onclick="sort('publishedDate')">Published <span id="publishedDate"></span></th>
  <th>Thumbnail</th>
  <th>Short Desc</th>
  <th>Long Desc</th>
  <th onclick="sort('status')">Status <span id="status"></span></th>
  <th>Authors</th>
  <th>Categories</th>
  <th onclick="sort('price')">Price <span id="price"></span></th>
  <th onclick="sort('currency')">Currency <span id="currency"></span></th>
  <th onclick="sort('discount')">Discount <span id="discount"></span></th>
  <th onclick="sort('discountUnits')">Discount Units <span id="discountUnits"></span></th>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

<p id="info"></p>

<script>
const url =
"https://raw.githubusercontent.com/edupoly/mongodb-data-sets/main/books.json";

let books = [];
let filtered = [];
let page = 1;
let limit = 10;
let sortKey = "";
let dir = 1;

fetch(url)
.then(res => res.json())
.then(data => {
  books = data;
  filtered = data;
  show();
});

function show() {
  let start = (page - 1) * limit;
  let end = start + limit;
  let rows = filtered.slice(start, end);

  let html = "";
  rows.forEach(b => {
    html += `
    <tr>
      <td class="truncate">${b.title || ""}</td>
      <td>${b.isbn || ""}</td>
      <td>${b.pageCount || ""}</td>
      <td>${b.publishedDate?.$date?.slice(0,10) || ""}</td>
      <td class="truncate url">
        <a href="${b.thumbnailUrl}" target="_blank">${b.thumbnailUrl || ""}</a>
      </td>
      <td class="truncate desc">${b.shortDescription || ""}</td>
      <td class="truncate desc">${b.longDescription || ""}</td>
      <td>${b.status || ""}</td>
      <td class="truncate">${(b.authors || []).join(", ")}</td>
      <td class="truncate">${(b.categories || []).join(", ")}</td>
      <td class="small">${b.price || ""}</td>
      <td class="small">${b.currency || ""}</td>
      <td class="small">${b.discount || ""}</td>
      <td class="small">${b.discountUnits || ""}</td>
    </tr>`;
  });

  tbody.innerHTML = html;

  let totalPages = Math.ceil(filtered.length / limit);
  info.innerText = `Page ${page} of ${totalPages}`;
  pageInput.value = page;
}

function changePage(step) {
  let totalPages = Math.ceil(filtered.length / limit);
  page += step;

  if (page < 1) page = 1;
  if (page > totalPages) page = totalPages;

  show();
}

function search(val) {
  filtered = books.filter(b =>
    JSON.stringify(b).toLowerCase().includes(val.toLowerCase())
  );
  page = 1;
  show();
}

function sort(key) {
  dir = sortKey === key ? -dir : 1;
  sortKey = key;

  filtered.sort((a, b) => {
    let x = a[key] || "";
    let y = b[key] || "";
    if (Array.isArray(x)) x = x.join(",");
    if (Array.isArray(y)) y = y.join(",");
    return x.toString().localeCompare(y.toString()) * dir;
  });

  document.querySelectorAll("th span").forEach(s => s.innerText = "");
  if (document.getElementById(key)) {
    document.getElementById(key).innerText = dir === 1 ? " ↑" : " ↓";
  }

  show();
}
</script>

</body>
</html>